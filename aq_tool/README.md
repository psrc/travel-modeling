# AQ Tool

This tool was created in response to multiple data requests from jurisidctions for city and county emissions. Data requests often required GHG emissions for non-modeled years, so forecasts were grown based on interpolations from previous models or scaled using HPMS data. This tool was provided due to a large data request from King County for emissions and VMT in every city in the county for multiple model and intermediate years. 

This tool uses Soundcast network outputs and emissions calculations scripts built from those used to calculate regional emissions totals. This allows a better consistency across emissions forecast products and more detailed results. Emissions can now be provided by vehicle type for any location, using spatial intersection of city (or other geographical) boundaries and network outputs. Rather than scaling on VMT, the emissions results are based directly on model network outputs, which are sensitive to local speeds, facility types, time of day, and other factors. 

## City Emissions

The main tool can be run from the "create_city_emissions.py". This script imports functions from local python scripts (functions.py, emissions.py) that perform spatial procedures and detailed emissions calculations. By default, this script produces VMT and emissions estimates for all cities in King County as well as Bainbridge Island (in Kitsap County). The default year is 2018, but the script could be run for any future year or scenario. The script is based on the standard emissions calculation script used in Soundcast, but is modified to apply calculations for city boundaries, interatively. This ensures only VMT within city limits is considered. Starting emissions (based on vehicles owned and bus fleet vehicles) is scaled to the city based on shares of households in the boundary. 

In 2022, Soundcast emissions rates were revised to include bus emissions. Even though these are not included in standard regional model runs, data requesters often asked for this data so we are making it available in this tool. See the [air_quality](https://github.com/psrc/travel-modeling/tree/master/air_quality/moves) directory in this repository for more information on the creation and automation of these rates from MOVES. 

After creating city emissions, users can run [summary_city_emissions.py](https://github.com/psrc/travel-modeling/blob/master/aq_tool/summarize_city_emissions.py) to produce annual estimates scaled by observed HPMS data. Observed HPMS data is [included in the repo](https://github.com/psrc/travel-modeling/blob/master/aq_tool/inputs/hpms_observed.csv). These county-level data on average VMT are reported annually by WSDOT. They are used to scale base year data based on county location. The summarize_city_emissions.py script creates estimates of city VMT by scaling from the county-level differences. This results in a summary of VMT and emissions for each year in which HPMS is available, as well as one year beyond that using interpolation. This was done because requestors often ask for the current year, which is generally not available from WSDOT.  

## County Emissions
Since city-level estimates are a new procedure, they may not match with past trends, complicating the inventory process that tracks trends over time. To help maintain consistency, some cities prefer county-level totals, to which they can apply their local trends. This repository includes scripts to calculated county-level totals for a model base year with the script `create_county_emissions.py`. One notable difference from city-level emissions is that results include passenger vehicle emissions broken out by SOV, HOV2, and HOV3 designations. The default of this approach also use metric tons instead of tons. Once county-level emissions are produced, a second script `process_results.py` takes the base year results and scales them based on county-level HPMS average VMT. This allows us to provide a reasonable estimate for emissions as a function of VMT in a county for years near the base year. This allows us to maintain an existing format (previously using simple interpolation between years), but revises it to use observed VMT under the assumption that emissions rates are static. Emissions rate assumptions can be modified in base years. See an example of the format often provided to data requests for county-level emissions inventories here: Y:\Air Quality\Data Requests\2024

Considerations: Tying emissions to VMT does not account for annual changes in emissiosn due to fleet turnover and less-polluting newer vehicles. A more sophisticated approach to this may prefer to use interpolated emissions rates (between model rates like 2018/2030) at a disaggregate scale against link-level VMT that has been scaled to match the observed data. 
