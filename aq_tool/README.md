# AQ Tool

This tool was created in response to multiple data requests from jurisidctions for city and county emissions. Data requests often required GHG emissions for non-modeled years, so forecasts were grown based on interpolations from previous models or scaled using HPMS data. This tool was provided due to a large data request from King County for emissions and VMT in every city in the county for multiple model and intermediate years. 

This tool uses Soundcast network outputs and emissions calculations scripts built from those used to calculate regional emissions totals. This allows a better consistency across emissions forecast products and more detailed results. Emissions can now be provided by vehicle type for any location, using spatial intersection of city (or other geographical) boundaries and network outputs. Rather than scaling on VMT, the emissions results are based directly on model network outputs, which are sensitive to local speeds, facility types, time of day, and other factors. 

## City Emissions

The main tool can be run from the "create_city_emissions.py". This script imports functions from local python scripts (functions.py, emissions.py) that perform spatial procedures and detailed emissions calculations. By default, this script produces VMT and emissions estimates for all cities in King County as well as Bainbridge Island (in Kitsap County). The default year is 2018, but the script could be run for any future year or scenario. The script is based on the standard emissions calculation script used in Soundcast, but is modified to apply calculations for city boundaries, interatively. This ensures only VMT within city limits is considered. Starting emissions (based on vehicles owned and bus fleet vehicles) is scaled to the city based on shares of households in the boundary. 

In 2022, Soundcast emissions rates were revised to include bus emissions. Even though these are not included in standard regional model runs, data requesters often asked for this data so we are making it available in this tool. See the [air_quality](https://github.com/psrc/travel-modeling/tree/master/air_quality/moves) directory in this repository for more information on the creation and automation of these rates from MOVES. 

After creating city emissions, users can run [summary_city_emissions.py](https://github.com/psrc/travel-modeling/blob/master/aq_tool/summarize_city_emissions.py) to produce annual estimates scaled by observed HPMS data. Observed HPMS data is [included in the repo](https://github.com/psrc/travel-modeling/blob/master/aq_tool/inputs/hpms_observed.csv). These county-level data on average VMT are reported annually by WSDOT. They are used to scale base year data based on county location. The summarize_city_emissions.py script creates estimates of city VMT by scaling from the county-level differences. This results in a summary of VMT and emissions for each year in which HPMS is available, as well as one year beyond that using interpolation. This was done because requestors often ask for the current year, which is generally not available from WSDOT.  

## County Emissions
Cities often request county-level emissions trends, to which they can further apply their local VMT data to scale emissions in a smaller geography. While the city-level analyses were prepared to assist with this work, sending county-level estimates ensures continuity for inventory trends. This repository includes an updated version of analysis that accounts for changes in emission rates and observed VMT for non-model years. The script [`create_county_emissions.py`](https://github.com/psrc/travel-modeling/blob/master/aq_tool/create_county_emissions_interpolated.py) generates emissions for a set of analysis years and includes a summary across years. 

This script is much less complicated than the city-level analyses because no geographic analysis is required and will run much faster. It can be performed for any county, but is set up to run for King County, which is the main requestor of this data. The script works by generating interpolated running and start emissions for an analysis year, using rates from 2018 and 2030 as bookends. These rates help account for a fleet turning over with newer, cleaner vehicles. Additionally, since only base-year VMT has been validated, VMT scaling is applied for an analysis year. Each link VMT value is modified based on county-level HPMS data. For instance if 2020 VMT was 15% less than in 2018, each link VMT is multiplied by 0.85. The VMT is then multiplied by the corresponding (interpolated) emission rate and summed up for the county. Start emissions are scaled by modeled vehicle ownership changes, interpolating between the 2018 base year and the 2030 RTP forecast. Start rates are also interpolated in the same manner as running emissions. This procuedure could be improved by using vehicle registration data to maintain some connection to observed trends, as is done with the HPMS. The script produces estimates for each year in a separate directory and generates 2 summary files:
- running_co2.csv
- running_vmt.csv

Outputs consistent with the 2023/2024 data request from Cascadia/BKR are available in the [outputs/interpolated/King] folder in this repository (https://github.com/psrc/travel-modeling/tree/master/aq_tool/output/interpolated/King). 

Note, that for consistency with older data, this script separates light-duty emissions by SOV, HOV2, and HOV3 designations. The default of this approach also uses metric tons instead of tons (as assumed in the RTP, for example). 
